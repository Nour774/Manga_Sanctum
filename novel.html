<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>2ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0f0f12;
      color: #eee;
    }

    header {
      padding: 16px;
      text-align: center;
      background: #16161d;
      font-size: 20px;
      font-weight: bold;
    }

    .container {
      padding: 16px;
    }

    .title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 16px;
      color: #aaa;
      margin-bottom: 4px;
    }

    .meta {
      font-size: 14px;
      color: #bbb;
      margin-bottom: 12px;
    }

    .description {
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .tags {
      margin-bottom: 16px;
    }

    .tags span {
      display: inline-block;
      background: #292932;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 6px;
      font-size: 12px;
    }

    .chapters ul {
      list-style: none;
      padding: 0;
    }

    .chapters li {
      background: #1b1b24;
      margin-bottom: 6px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .chapters li:hover {
      transform: translateX(4px);
      background: #2a2a35;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #aaa;
    }

  </style>
</head>
<body>

<header>ğŸ“– ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©</header>

<div class="container">
  <div class="title" id="title"></div>
  <div class="subtitle" id="subtitle"></div>
  <div class="meta" id="meta"></div>
  <div class="description" id="description"></div>

  <div class="tags" id="tags"><strong>Ø§Ù„Ø£ÙˆØ³Ù…Ø©:</strong> </div>

  <div class="chapters">
    <strong>Ø§Ù„ÙØµÙˆÙ„:</strong>
    <ul id="chapters"></ul>
  </div>

  <div id="loading" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
</div>

<script>
const apiBase = "https://api.rewayat.club";
const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");

const titleEl = document.getElementById("title");
const subtitleEl = document.getElementById("subtitle");
const metaEl = document.getElementById("meta");
const descriptionEl = document.getElementById("description");
const tagsEl = document.getElementById("tags");
const chaptersEl = document.getElementById("chapters");
const loadingEl = document.getElementById("loading");

async function loadNovel() {
  if (!slug) return;

  loadingEl.style.display = "block";

  try {
    const res = await fetch(`${apiBase}/api/novels/${slug}/`);
    if (!res.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©");

    const novel = await res.json();

    titleEl.textContent = novel.arabic;
    subtitleEl.textContent = novel.english;
    metaEl.textContent = `${novel.complete ? "Ù…ÙƒØªÙ…Ù„Ø©" : "Ù…Ø³ØªÙ…Ø±Ø©"} Â· ${novel.num_chapters || "?"} ÙØµÙ„`;
    descriptionEl.textContent = novel.about || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­.";

    // Ø§Ù„Ø£ÙˆØ³Ù…Ø©
    tagsEl.innerHTML = "<strong>Ø§Ù„Ø£ÙˆØ³Ù…Ø©:</strong> ";
    if (novel.genre && novel.genre.length > 0) {
      novel.genre.forEach(g => {
        const span = document.createElement("span");
        span.textContent = g.name; // Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø·
        tagsEl.appendChild(span);
      });
    } else {
      tagsEl.innerHTML += "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ³Ù…Ø©";
    }

    // Ø§Ù„ÙØµÙˆÙ„
    chaptersEl.innerHTML = "";
    if (novel.chapters && novel.chapters.length > 0) {
      novel.chapters.forEach(ch => {
        const li = document.createElement("li");
        li.textContent = ch.title;
        li.addEventListener("click", () => {
          window.location.href = `chapter.html?slug=${slug}&chapter=${ch.number}`;
        });
        chaptersEl.appendChild(li);
      });
    } else {
      chaptersEl.innerHTML = "<li>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØµÙˆÙ„ Ù…ØªØ§Ø­Ø©</li>";
    }

  } catch (err) {
    console.error(err);
    descriptionEl.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©.";
  } finally {
    loadingEl.style.display = "none";
  }
}

loadNovel();
</script>

</body>
</html>
