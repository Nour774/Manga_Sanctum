<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“š Ù…ÙƒØªØ¨Ø© Ø±ÙˆØ§ÙŠØ§Øª - Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin:0; font-family:system-ui,sans-serif; background:#0f0f12; color:#eee; }
header { padding:16px; text-align:center; background:#16161d; font-size:20px; font-weight:bold; }
.section { padding:16px; }
.section h3 { margin-bottom:12px; font-size:18px; border-bottom:1px solid #333; padding-bottom:4px; }
#grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:16px; }
.card { background:#1b1b24; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; transition: transform 0.2s; cursor:pointer; }
.card:hover { transform:translateY(-4px); }
.card img { width:100%; height:230px; object-fit:cover; background:#000; }
.card .info { padding:10px; flex:1; }
.title { font-size:14px; font-weight:bold; margin-bottom:4px; }
.subtitle { font-size:12px; color:#aaa; }
.meta { font-size:11px; margin-top:6px; color:#bbb; }
.loading { text-align:center; padding:20px; color:#aaa; }
</style>
</head>
<body>

<header>ğŸ“š Ù…ÙƒØªØ¨Ø© Ø±ÙˆØ§ÙŠØ§Øª - Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</header>

<div class="section">
  <h3>Ø§Ù„ÙŠÙˆÙ…</h3>
  <div class="novels-group" id="today"></div>
</div>

<div class="section">
  <h3>Ø£Ù…Ø³</h3>
  <div class="novels-group" id="yesterday"></div>
</div>

<div class="section">
  <h3>ØªØ§Ø±ÙŠØ® Ø³Ø§Ø¨Ù‚</h3>
  <div class="novels-group" id="older"></div>
</div>

<div id="loading" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>

<script>
const apiBase = "https://api.rewayat.club";
const proxy = "https://corsproxy.io/?"; // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ø­Ø³Ø¨ Ø­Ø§Ø¬ØªÙƒ

function proxiedUrl(url) {
    return proxy + encodeURIComponent(url);
}

// Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ØªØ§Ø±ÙŠØ®: Ø§Ù„ÙŠÙˆÙ… / Ø£Ù…Ø³ / Ø£Ù‚Ø¯Ù…
function categorizeDate(updated_at) {
    const d = new Date(updated_at);
    const now = new Date();
    const diff = now - d;
    const oneDay = 24*60*60*1000;
    if (diff < oneDay) return "today";
    else if (diff < 2*oneDay) return "yesterday";
    else return "older";
}

// Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
function addNovelToSection(novel, section) {
    const container = document.getElementById(section);

    // Ø¯Ù…Ø¬ Ø§Ù„ØªÙƒØ±Ø§Ø±: Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙŠØ­Ø¯Ø« ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ø§Ù„ÙØµÙˆÙ„
    let existing = Array.from(container.children).find(c => c.dataset.slug === novel.slug);
    if (existing) {
        existing.querySelector(".meta").textContent = 
          (novel.complete ? "Ù…ÙƒØªÙ…Ù„Ø©" : "Ù…Ø³ØªÙ…Ø±Ø©") + " Â· " + novel.num_chapters + " ÙØµÙ„";
        return;
    }

    const card = document.createElement("div");
    card.className = "card";
    card.dataset.slug = novel.slug;

    const img = document.createElement("img");
    img.src = proxiedUrl(apiBase + novel.poster_url);
    img.loading = "lazy";

    const info = document.createElement("div");
    info.className = "info";
    info.innerHTML = `
        <div class="title">${novel.arabic}</div>
        <div class="subtitle">${novel.english}</div>
        <div class="meta">${novel.complete ? "Ù…ÙƒØªÙ…Ù„Ø©" : "Ù…Ø³ØªÙ…Ø±Ø©"} Â· ${novel.num_chapters} ÙØµÙ„</div>
    `;

    card.appendChild(img);
    card.appendChild(info);

    card.addEventListener("click", () => {
        window.location.href = `novel.html?slug=${novel.slug}`;
    });

    container.appendChild(card);
}

let nextUrl = apiBase + "/api/novels/";

async function loadPage() {
    if (!nextUrl) return;
    document.getElementById("loading").style.display = "block";

    try {
        const res = await fetch(proxiedUrl(nextUrl));
        const data = await res.json();

        data.results.forEach(novel => {
            const section = categorizeDate(novel.updated_at);
            addNovelToSection(novel, section);
        });

        nextUrl = data.next;
    } catch(e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:", e);
        nextUrl = null;
    } finally {
        document.getElementById("loading").style.display = "none";
    }
}

// Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± (Infinite scroll)
window.addEventListener("scroll", () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
        loadPage();
    }
});

// ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ ØµÙØ­Ø©
loadPage();
</script>

</body>
</html>
